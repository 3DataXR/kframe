!function(e){function t(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");var a;AFRAME.registerSystem("audioanalyser",{init:function(){this.analysers={}},getOrCreateAnalyser:function(e){a||(a=new AudioContext);var t=this.analysers,n=a.createAnalyser(),i=e.src,l=i.getAttribute("src");if(!e.unique&&t[l])return t[l];var s=a.createMediaElementSource(i);return s.connect(n),n.connect(a.destination),n.smoothingTimeConstant=e.smoothingTimeConstant,n.fftSize=e.fftSize,t[l]=n,{analyser:t[l],source:s}}}),AFRAME.registerComponent("audioanalyser",{schema:{beatDetectionDecay:{default:.99},beatDetectionMinVolume:{default:15},beatDetectionThrottle:{default:250},enableBeatDetection:{default:!0},enableLevels:{default:!0},enableWaveform:{default:!0},enableVolume:{default:!0},fftSize:{default:2048},smoothingTimeConstant:{default:.8},src:{type:"selector"},unique:{default:!1}},init:function(){this.analyser=null,this.levels=null,this.waveform=null,this.volume=0},update:function(){function e(e){a.analyser=e,a.levels=new Uint8Array(a.analyser.frequencyBinCount),a.waveform=new Uint8Array(a.analyser.fftSize),a.el.emit("audioanalyser-ready",e,!1)}var t=this.data,a=this,n=this.system;t.src&&e(n.getOrCreateAnalyser(t).analyser)},tick:function(e,t){var a=this.data;if(this.analyser){if((a.enableLevels||a.enableVolume)&&this.analyser.getByteFrequencyData(this.levels),a.enableWaveform&&this.analyser.getByteTimeDomainData(this.waveform),a.enableVolume||a.enableBeatDetection){for(var n=0,i=0;i<this.levels.length;i++)n+=this.levels[i];this.volume=n/this.levels.length}a.enableBeatDetection&&(volume=this.volume,this.beatCutOff||(this.beatCutOff=volume),volume>this.beatCutOff&&volume>this.data.beatDetectionMinVolume?(console.log("[audioanalyser] Beat detected."),this.el.emit("audioanalyser-beat",null,!1),this.beatCutOff=1.5*volume,this.beatTime=0):this.beatTime<=this.data.beatDetectionThrottle?this.beatTime+=t:(this.beatCutOff*=this.data.beatDetectionDecay,this.beatCutOff=Math.max(this.beatCutOff,this.data.beatDetectionMinVolume)))}}})}]);